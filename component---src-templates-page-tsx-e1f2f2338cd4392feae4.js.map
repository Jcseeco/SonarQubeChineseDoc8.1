{"version":3,"sources":["webpack:///./src/components/HeaderList.tsx","webpack:///./src/templates/page.tsx"],"names":["HeaderList","componentDidMount","this","context","headers","setHeaders","props","componentDidUpdate","prevProps","length","render","React","contextTypes","PropTypes","isRequired","Page","baseUrl","window","location","origin","collapsables","document","getElementsByClassName","i","classList","add","customBlockWrapper","querySelector","firstChild","firstElementChild","outerHTML","replace","addEventListener","event","preventDefault","currentTarget","parentElement","toggle","content","page","data","markdownRemark","version","process","GATSBY_DOCS_VERSION","pageTitle","frontmatter","title","htmlPageContent","html","realHeadingsList","headings","filter","heading","indexOf","value","match","regex","RegExp","replaceImageLinks","replaceDynamicLinks","counter","forEach","h","depth","createAnchorForHeadings","removeTableOfContents","react","Helmet_default","a","lang","href","rel","pathname","type","HeaderList_HeaderList","className","dangerouslySetInnerHTML","__html","query"],"mappings":"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","file":"component---src-templates-page-tsx-e1f2f2338cd4392feae4.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport { MarkdownHeading } from '../@types/graphql-types';\n\ninterface Props {\n  headers: MarkdownHeading[];\n}\n\nexport default class HeaderList extends React.PureComponent<Props> {\n  static contextTypes = {\n    headers: PropTypes.object.isRequired\n  };\n\n  componentDidMount() {\n    this.context.headers.setHeaders(this.props.headers);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (prevProps.headers.length !== this.props.headers.length) {\n      this.context.headers.setHeaders(prevProps.headers);\n    }\n  }\n\n  render() {\n    return null;\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2020 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { graphql } from 'gatsby';\nimport * as React from 'react';\nimport Helmet from 'react-helmet';\nimport { MarkdownHeading, MarkdownRemark, MarkdownRemarkConnection } from '../@types/graphql-types';\nimport HeaderList from '../components/HeaderList';\n\ninterface Props {\n  data: {\n    allMarkdownRemark: Pick<MarkdownRemarkConnection, 'edges'>;\n    markdownRemark: Pick<MarkdownRemark, 'html' | 'headings' | 'frontmatter'>;\n  };\n  location: Location;\n}\n\nexport default class Page extends React.PureComponent<Props> {\n  baseUrl = '';\n\n  componentDidMount() {\n    if (window) {\n      this.baseUrl = window.location.origin + '/';\n    }\n    const collapsables = document.getElementsByClassName('collapse');\n\n    for (let i = 0; i < collapsables.length; i++) {\n      collapsables[i].classList.add('close');\n      const customBlockWrapper = collapsables[i].querySelector('.custom-block-body');\n      if (customBlockWrapper) {\n        let firstChild = customBlockWrapper.firstElementChild;\n        if (firstChild) {\n          firstChild.outerHTML = firstChild.outerHTML\n            .replace(/<h2/gi, '<a href=\"#\"')\n            .replace(/<\\/h2>/gi, '</a>');\n\n          // We changed the element. It's reference is no longer correct in some\n          // browsers. Fetch it again.\n          firstChild = customBlockWrapper.firstElementChild;\n          firstChild!.addEventListener('click', (event: Event & { currentTarget: HTMLElement }) => {\n            event.preventDefault();\n            if (\n              event.currentTarget.parentElement &&\n              event.currentTarget.parentElement.parentElement\n            ) {\n              event.currentTarget.parentElement.parentElement.classList.toggle('close');\n            }\n          });\n        }\n      }\n    }\n  }\n\n  render() {\n    const page = this.props.data.markdownRemark;\n    const version = process.env.GATSBY_DOCS_VERSION || '8.1';\n    const mainTitle = 'SonarQube 文件';\n    const pageTitle = page.frontmatter && page.frontmatter.title;\n\n    let htmlPageContent = page.html || '';\n\n    const realHeadingsList = removeExtraHeadings(htmlPageContent, page.headings || []);\n\n    htmlPageContent = removeTableOfContents(htmlPageContent);\n    htmlPageContent = createAnchorForHeadings(htmlPageContent, realHeadingsList);\n    htmlPageContent = replaceDynamicLinks(htmlPageContent);\n    htmlPageContent = replaceImageLinks(htmlPageContent);\n\n    return (\n      <>\n        <Helmet title={pageTitle ? `${pageTitle} | ${mainTitle}` : mainTitle}>\n          <html lang=\"zh-TW\" />\n          <link href={`/SonarQubeChineseDoc${version}/favicon.ico`} rel=\"icon\" />\n          <link\n            href={this.baseUrl + this.props.location.pathname.replace(version, 'latest')}\n            rel=\"canonical\"\n          />\n          <script type=\"text/javascript\">{`\n            (function(window,document) {\n              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n              })(window, document,'script','https://www.google-analytics.com/analytics.js','ga');\n              ga('create', 'UA-1880045-11' , 'auto');\n              ga('send', 'pageview');\n            })(window,document);\n          `}</script>\n        </Helmet>\n        <HeaderList headers={realHeadingsList} />\n        <h1>{pageTitle || mainTitle}</h1>\n        <div\n          className=\"markdown-content\"\n          // Safe: comes from the backend\n          dangerouslySetInnerHTML={{ __html: htmlPageContent }}\n        />\n      </>\n    );\n  }\n}\n\nexport const query = graphql`\n  query($slug: String!) {\n    allMarkdownRemark {\n      edges {\n        node {\n          html\n          fields {\n            slug\n          }\n        }\n      }\n    }\n    markdownRemark(fields: { slug: { eq: $slug } }) {\n      html\n      headings {\n        depth\n        value\n      }\n      frontmatter {\n        title\n      }\n    }\n  }\n`;\n\nfunction replaceImageLinks(content: string) {\n  const version = process.env.GATSBY_DOCS_VERSION || '';\n  if (version !== '') {\n    content = content.replace(/<img src=\"\\/images\\/(.*?)\"/gim, `<img src=\"/${version}/images/$1\"`);\n  }\n  return content;\n}\n\nfunction replaceDynamicLinks(content: string) {\n  // Make outside link open in a new tab\n  content = content.replace(\n    /<a href=\"http(.*?)\">(.*?)<\\/a>/gim,\n    '<a href=\"http$1\" target=\"_blank\">$2</a>'\n  );\n\n  // Render only the text part of links going inside the app\n  return content.replace(\n    /<a href=\"(.*)\\/#(?:sonarqube|sonarcloud|sonarqube-admin)#.*?\">(.*?)<\\/a>/gim,\n    '$2'\n  );\n}\n\n/**\n * For the sidebar table of content, we do not want headers for sonarcloud,\n * collapsable container title, of table of contents headers.\n */\nfunction removeExtraHeadings(content: string, headings: MarkdownHeading[]) {\n  return headings\n    .filter(\n      heading =>\n        content.indexOf(\n          `<div class=\"custom-block collapse\"><div class=\"custom-block-body\"><h2>${heading.value}</h2>`\n        ) < 0\n    )\n    .filter(heading => !heading.value || !heading.value.match(/Table of content/i))\n    .filter(heading => {\n      const regex = new RegExp(\n        `<!-- sonarcloud -->[\\\\s\\\\S]*<h2>${heading.value!.replace(\n          /[.*+?^${}()|[\\]\\\\]/g,\n          '\\\\$&'\n        )}<\\\\/h2>[\\\\s\\\\S]*<!-- /sonarcloud -->`,\n        'gim'\n      );\n      return !content.match(regex);\n    });\n}\n\nfunction createAnchorForHeadings(content: string, headings: MarkdownHeading[]) {\n  let counter = 1;\n  headings.forEach(h => {\n    if (h.depth === 2) {\n      content = content.replace(\n        `<h${h.depth}>${h.value}</h${h.depth}>`,\n        `<h${h.depth} id=\"header-${counter}\">${h.value}</h${h.depth}>`\n      );\n      counter++;\n    }\n  });\n  return content;\n}\n\nfunction removeTableOfContents(content: string) {\n  return content.replace(/<h[1-9]>Table Of Contents<\\/h[1-9]>/i, '');\n}\n"],"sourceRoot":""}